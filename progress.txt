# Ralph Progress Log
Started: 2026-01-12

## Codebase Patterns
- Go version flag: Use `-ldflags="-X main.version=$VERSION"` to inject version at build time
- Reference /home/sprite/spritedrop for patterns (install.sh, release.yml, README.md)
- CLI subcommands: Use flag.NewFlagSet for each subcommand
- Syncthing config: XML at ~/.config/syncthing/config.xml, API at 127.0.0.1:8384
- Syncthing API key: Read from config.xml GUI.apikey element
- Tailscale hostname: `tailscale status --json` -> .Self.HostName
- Taildrop file exchange: `tailscale file cp <file> <target>:` and `tailscale file get <dir>`
- Deterministic IDs: Sort inputs alphabetically before hashing for consistent IDs regardless of order

## Key Files
- main.go - CLI entry point with version flag and subcommands
- .github/workflows/release.yml - Multi-platform build pipeline
- install.sh - Installer for Syncthing + Tailscale setup

---

## 2026-01-12 - US-002
**Repository setup with Go module and GitHub Actions**

Files changed:
- go.mod (already existed, verified correct)
- main.go (created)
- .github/workflows/release.yml (created)
- .gitignore (created)

**Learnings:**
- go.mod was already present with correct module name
- Version injection via ldflags works: `go build -ldflags="-X main.version=v1.0.0"`
- Release workflow builds for linux/darwin amd64/arm64 matrix
---

## 2026-01-12 - US-003
**Install script with Syncthing and Tailscale setup**

Files changed:
- install.sh (created)

**Learnings:**
- Syncthing apt repo: Add key via `curl -fsSL https://syncthing.net/release-key.gpg | sudo gpg --dearmor -o /etc/apt/keyrings/syncthing-archive-keyring.gpg`
- Syncthing CLI for config: `syncthing cli config options listen-addresses set "tcp://<ip>:22000"`
- Disable discovery: `syncthing cli config options global-announce-enabled set false`
- sprite-env service dependency: use `--needs tailscaled`
- systemd service dependency: use `After=tailscaled.service` and `Wants=tailscaled.service`
- Generate initial config with: `syncthing generate --config=<dir>`
---

## 2026-01-12 - US-004
**Core CLI commands: init, info, status**

Files changed:
- main.go (updated with CLI subcommands)
- prd.json (created to track progress)
- progress.txt (created)

**Learnings:**
- Syncthing device ID can be retrieved via: CLI (`syncthing cli show system`), REST API (`/rest/system/status`), or config.xml
- Tailscale hostname: `tailscale status --json` returns .Self.HostName
- XML parsing: Use `xml:"tagname"` for elements, `xml:"name,attr"` for attributes
- API requests to Syncthing require X-API-Key header
- flag.NewFlagSet allows subcommand-specific flags
---

## 2026-01-12 - US-005
**Device pairing via Taildrop**

Files changed:
- main.go (added pair and devices commands)

**Learnings:**
- Taildrop send: `tailscale file cp <file> <device>:`
- Taildrop receive: `tailscale file get --wait=1s <dir>` for polling
- Syncthing add device: `syncthing cli config devices add --device-id <id> --name <name>`
- Syncthing auto-accept: `syncthing cli config devices <id> auto-accept-folders set true`
- Pairing protocol: Exchange device ID + hostname in text file via Taildrop
- Both devices must run pair command simultaneously for bi-directional exchange
---

## 2026-01-12 - US-006
**Folder sync commands: sync and unsync**

Files changed:
- main.go (added sync and unsync commands)

**Learnings:**
- Deterministic folder ID: Hash sorted hostnames + path with SHA-256, use first 8 bytes
- Syncthing add folder: `syncthing cli config folders add --id <id> --label <label> --path <path>`
- Syncthing share folder: `syncthing cli config folders <id> devices add --device-id <device-id>`
- Syncthing remove folder: `syncthing cli config folders remove --id <id>`
- Path expansion: Handle ~ prefix by joining with $HOME
- Folder lookup by path: Iterate getSyncthingFolders() and match Path field
---
